"use strict";var e=require("fs"),s=require("path"),a=require("@dcloudio/uni-cli-shared");function r(e){if(e&&e.__esModule)return e;var s=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var r=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(s,a,r.get?r:{enumerable:!0,get:function(){return e[a]}})}})),s.default=e,Object.freeze(s)}var t=r(e),u=r(s);module.exports=class{constructor(e){let{dir:s,uniModules:a}=e;s&&(s=u.resolve(process.env.UNI_INPUT_DIR,s)),a&&(a=a.map((e=>Object.assign(Object.assign({},e),{path:u.resolve(process.env.UNI_INPUT_DIR,`uni_modules/${e.id}/${e.path}`)})))),this.routerDir=s,this.routerFiles=a}getPageJson(e){const s=this.routerDir,r={pages:[],subPackages:[]};if(s&&t.existsSync(s)){let c=t.readdirSync(s);c=c.filter((e=>e.endsWith(".json")));for(const o of c){const c=u.resolve(s,o),n=a.parseJson(t.readFileSync(c).toString(),!0);e(c),r.pages.push(...n.pages||[]),r.subPackages.push(...n.subPackages||[])}}const c=this.routerFiles,o={pages:[],subPackages:[]};return null==c||c.forEach((s=>{if(t.existsSync(s.path)){const r=function(e,s){return Array.isArray(e.pages)&&e.pages.forEach((e=>{e.path="uni_modules/"+s+"/"+e.path})),Array.isArray(e.subPackages)&&e.subPackages.forEach((e=>{e.root="uni_modules/"+s+"/"+e.root})),e}(a.parseJson(t.readFileSync(s.path).toString(),!0),s.id);e(s.path),o.pages.push(...r.pages||[]),o.subPackages.push(...r.subPackages||[])}})),{pages:[...r.pages,...o.pages],subPackages:[...r.subPackages,...o.subPackages]}}loader(e,{addDependency:s}){const{pages:a=[],subPackages:r=[]}=this.getPageJson(s);return e.pages=e.pages||[],e.subPackages=e.subPackages||[],e.pages.push(...a),e.subPackages.push(...r),e}};
